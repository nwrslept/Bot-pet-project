from database.db import get_connection

MESSAGES = {

"uk": {
        "start1": "👋 Вітаю, {user}!",
        "start2": "Це мій невеличкий пет-проєкт — 🛠️ Telegram-бот-помічник,"
                  " який допоможе зробити твої повсякденні справи простішими та приємнішими 😌",
        "start3": "Вибери дію з меню нижче 👇",

        "menu_profile": "👤 Профіль",
        "profile_title": "👤 Твій профіль:",
        "profile_id": "🆔 Telegram ID: ",
        "profile_username": "👥 Username: ",
        "profile_first_name": "📛 Ім’я: ",
        "button_saved_ideas": "📚 Мої збережені ідеї",
        "profile_not_found": "❌ Тебе немає в базі даних.",
        "no_ideas": "У тебе поки немає збережених ідей.",
        "button_delete": "❌ Видалити",
        "idea_deleted": "Ідею видалено ✅",
        "choosed_language": "Мову змінено",
        "menu_language": "🌍 Мова",
        "menu_chat_gemini": "🤖 Чат з Gemini",
        "menu_generate_idea": "💡 Згенерувати ідею",
        "menu_news": "📰 Новини",
        "button_leave_chat": "🚪 Покинути чат",
        "chat_start": "🧠 Ти в чаті з Gemini. Напиши питання!",
        "chat_exit": "🚪 Ти вийшов з чату з Gemini.",
        "chat_error": "⚠ Помилка при зверненні до Gemini:\n{error}",
        "chat_context_instruction": "Відповідай українською мовою, дружелюбно, і не сильно розгорнуто якщо цього не попросить користувач",

        "idea_choose_topic": "Оберіть тему для ідеї 💡",
        "choose_difficulty": "Оберіть рівень складності:",
        "idea_prompt": "Ти — генератор ідей для Python-скриптів. Тема: {topic}. Складність: {difficulty}.Не повторюй попередні ідеї:\n\n{context} Згенеруй унікальну коротку ідею скрипта без пояснень та коду.",
        "no_previous_ideas": "(Ще немає попередніх ідей)",
        "idea_result": "💡 Ідея ({topic}, {difficulty}):\n{idea}",
        "idea_error": "⚠ Помилка при генерації ідеї:",
        "idea_invalid_data": "⚠ Некоректні дані.",
        "generating_idea": "🔄 Генеруємо ідею...",
        "save_idea_btn": "💾 Зберегти ідею",
        "more_idea_btn": "🔄 Ще",
        "idea_saved": "Ідею збережено ✅",
        "idea_save_error": "Помилка при збереженні:",
        "no_idea_to_save": "Немає ідеї для збереження.",
        "no_data_for_idea": "Немає даних для генерації нової ідеї.",
        "topic_telegram": "Телеграм-бот",
        "topic_scraper": "Скрейпер",
        "topic_analytics": "Аналітика",
        "topic_game": "Гра",
        "topic_utility": "Утиліта",
        "topic_neural": "Нейронка",
        "difficulty_easy": "Легка",
        "difficulty_medium": "Середня",
        "difficulty_hard": "Складна",
        "news_browse": "🔍 Переглянути",
        "news_subscribe": "📩 Підписатися",
        "news_topic_politics": "🏛️ Політика",
        "news_topic_sports": "⚽ Спорт",
        "news_topic_technology": "💻 Технології",
        "news_topic_health": "🩺 Здоров’я",
        "news_topic_entertainment": "🎉 Розваги",
        "news_more": "Ще 📰",
        "back": "⬅ Назад",
        "news_what_to_do": "Що бажаєш зробити?",
        "news_choose_topic": "Оберіть тему новин:",
        "news_choose_topic_first": "Обери тему новин спочатку.",
        "subscription_menu": "🔔 Меню підписки на новини",
        "choose_frequency": "📅 Обери частоту надсилання новин:",
        "frequency_updated": "✅ Частоту оновлено!",
        "choose_topics": "📰 Обери теми новин:",
        "topics_saved": "✅ Тема(и) збережено!",
        "unsubscribed": "❌ Ви відписалися від розсилки новин.",
        "what_to_do": "Що бажаєш зробити?",
        "frequency_btn": "🔁 Частота",
        "topics_btn": "📚 Теми",
        "unsubscribe_btn": "❌ Відписатись",
        "back_btn": "⬅ Назад",
        "subscribe_btn": "🔔 Підписатись",
        "freq_once": "1 раз (🕒12:00)",
        "freq_twice": "2 рази (🕒9:00, 🕒21:00)",
        "freq_thrice": "3 рази (🕒9:00, 🕒14:00, 🕒21:00)",
        "topic_business": "🏛️ Політика",
        "topic_sports": "⚽ Спорт",
        "topic_technology": "💻 Технології",
        "topic_health": "🩺 Здоров’я",
        "topic_entertainment": "🎉 Розваги",
        "done_btn": "✅ Готово",
        "menu_steam": "🎮 Стім",
        "steam.add_instruction": "👋 Схоже, ти ще не додав свій Steam-профіль...\n\n🔹 Надішли SteamID64 або посилання на профіль...",
        "steam.choose_action": "🔧 Оберіть дію:",
        "steam.saved": "✅ Новий Steam-профіль збережено!",
        "steam.invalid_input": "🚫 Невірне посилання або ID. Спробуйте ще раз.",
        "steam.status.online": "у мережі",
        "steam.status.offline": "🕸 офлайн",
        "steam.profile_not_found": "❗ Профіль не знайдено. Додайте Steam ID.",
        "steam.profile_error": "🚫 Не вдалося отримати інформацію про профіль.",
        "steam.enter_new": "✏️ Введіть новий SteamID64 або посилання на свій Steam-профіль:",
        "steam.finding_friends": "⏳ Шукаю друзів онлайн...",
        "steam.no_friends": "⚠️ Не вдалося отримати список друзів...",
        "steam.no_one_online": "😴 Ніхто з друзів не в мережі",
        "steam.friends_online": "👥 Онлайн друзі:",
        "steam.status": "Статус",
        "steam.view_profile": "Перейти до профілю",
        "steam.menu.profile": "👤 Мій профіль",
        "steam.menu.change": "✏️ Змінити посилання",
        "steam.menu.friends": "👥 Список друзів",
        "steam.menu.back": "🔙 Назад до меню",



},

    "en": {
        "start1": "👋 Hello {user}!",
        "start2": "This is my little pet project — 🛠️ A Telegram bot assistant "
                  "that will help make your everyday tasks easier and more enjoyable 😌",
        "start3": "Choose an action from the menu below 👇",

        "menu_profile": "👤 Profile",
        "profile_title": "👤 Your profile:",
        "profile_id": "🆔 Telegram ID: ",
        "profile_username": "👥 Username: ",
        "profile_first_name": "📛 Name: ",
        "button_saved_ideas": "📚 My saved ideas",
        "profile_not_found": "❌ You are not in the database.",
        "no_ideas": "You don't have any saved ideas yet.",
        "button_delete": "❌ Delete",
        "idea_deleted": "Idea deleted ✅",
        "choosed_language": "Language changed",
        "menu_language": "🌍 Language",
        "menu_chat_gemini": "🤖 Chat with Gemini",
        "menu_generate_idea": "💡 Generate idea",
        "menu_news": "📰 News",
        "button_leave_chat": "🚪 Leave chat",
        "chat_start": "🧠 You are in chat with Gemini. Write your question!",
        "chat_exit": "🚪 You left the chat with Gemini.",
        "chat_error": "⚠ Error contacting Gemini:\n{error}",
        "chat_context_instruction": "Answer in English, friendly, and not too verbose unless the user requests.",
        "idea_choose_topic": "Choose a topic for the idea 💡",
        "choose_difficulty": "Choose the difficulty level:",
        "idea_prompt": "You are a generator of Python script ideas. Topic: {topic}. Difficulty: {difficulty}. Do not repeat previous ideas:\n\n{context} Generate a unique short idea for a script without explanations or code.",
        "no_previous_ideas": "(No previous ideas yet)",
        "idea_result": "💡 Idea ({topic}, {difficulty}):\n{idea}",
        "idea_error": "⚠ Error generating idea:",
        "idea_invalid_data": "⚠ Invalid data.",
        "generating_idea": "🔄 Generating idea...",
        "save_idea_btn": "💾 Save idea",
        "more_idea_btn": "🔄 More",
        "idea_saved": "Idea saved ✅",
        "idea_save_error": "Error saving idea:",
        "no_idea_to_save": "No idea to save.",
        "no_data_for_idea": "No data to generate a new idea.",
        "topic_telegram": "Telegram bot",
        "topic_scraper": "Scraper",
        "topic_analytics": "Analytics",
        "topic_game": "Game",
        "topic_utility": "Utility",
        "topic_neural": "Neural network",
        "difficulty_easy": "Easy",
        "difficulty_medium": "Medium",
        "difficulty_hard": "Hard",
        "news_browse": "🔍 Browse",
        "news_subscribe": "📩 Subscribe",
        "news_topic_politics": "🏛️ Politics",
        "news_topic_sports": "⚽ Sports",
        "news_topic_technology": "💻 Technology",
        "news_topic_health": "🩺 Health",
        "news_topic_entertainment": "🎉 Entertainment",
        "news_more": "More 📰",
        "back": "⬅ Back",
        "news_what_to_do": "What would you like to do?",
        "news_choose_topic": "Choose a news topic:",
        "news_choose_topic_first": "Please choose a news topic first.",
        "subscription_menu": "🔔 News subscription menu",
        "choose_frequency": "📅 Choose news sending frequency:",
        "frequency_updated": "✅ Frequency updated!",
        "choose_topics": "📰 Choose news topics:",
        "topics_saved": "✅ Topics saved!",
        "unsubscribed": "❌ You have unsubscribed from the news mailing.",
        "what_to_do": "What do you want to do?",
        "frequency_btn": "🔁 Frequency",
        "topics_btn": "📚 Topics",
        "unsubscribe_btn": "❌ Unsubscribe",
        "back_btn": "⬅ Back",
        "subscribe_btn": "🔔 Subscribe",
        "freq_once": "Once (🕒12:00)",
        "freq_twice": "Twice (🕒9:00, 🕒21:00)",
        "freq_thrice": "Thrice (🕒9:00, 🕒14:00, 🕒21:00)",
        "topic_business": "🏛️ Politics",
        "topic_sports": "⚽ Sports",
        "topic_technology": "💻 Technology",
        "topic_health": "🩺 Health",
        "topic_entertainment": "🎉 Entertainment",
        "done_btn": "✅ Done",
        "menu_steam": "🎮 Steam",
        "steam.add_instruction": "👋 It looks like you haven't added your Steam profile yet...\n\n🔹 Send your SteamID64 or profile link...",
        "steam.choose_action": "🔧 Choose an action:",
        "steam.saved": "✅ New Steam profile saved!",
        "steam.invalid_input": "🚫 Invalid link or ID. Please try again.",
        "steam.status.online": "online",
        "steam.status.offline": "🕸 offline",
        "steam.profile_not_found": "❗ Profile not found. Add your Steam ID.",
        "steam.profile_error": "🚫 Failed to retrieve profile info.",
        "steam.enter_new": "✏️ Enter your new SteamID64 or profile link:",
        "steam.finding_friends": "⏳ Searching for online friends...",
        "steam.no_friends": "⚠️ Could not retrieve friends. Maybe profile is private.",
        "steam.no_one_online": "😴 None of your friends are online",
        "steam.friends_online": "👥 Friends online:",
        "steam.status": "Status",
        "steam.view_profile": "View Profile",
        "steam.menu.profile": "👤 My Profile",
        "steam.menu.change": "✏️ Change Link",
        "steam.menu.friends": "👥 Friend List",
        "steam.menu.back": "🔙 Back to Menu",


    },

}

def t(lang: str, key: str, **kwargs) -> str:
    """Отримати повідомлення за ключем і мовою, з підстановкою значень."""
    text = MESSAGES.get(lang, MESSAGES["en"]).get(key, key)
    return text.format(**kwargs)

def get_user_language(telegram_id: int) -> str:
    conn = get_connection()
    cursor = conn.cursor()
    cursor.execute("SELECT language FROM users WHERE telegram_id = ?", (telegram_id,))
    result = cursor.fetchone()
    conn.close()
    return result[0] if result else "uk"  # fallback

